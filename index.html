<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shiny Hunting Game</title>
  <!-- Inline CSS so that this file is self‑contained. The styles are identical to the
       original style.css file used in the web version. -->
  <style>
  /* Basic reset */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Arial', sans-serif;
    user-select: none;
  }

  body, html {
    width: 100%;
    height: 100%;
    background-color: #000;
    color: #fff;
  }

  #app {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .screen {
    display: none;
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .header {
    padding: 8px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    background: rgba(0,0,0,0.5);
  }

  .summary {
    padding: 10px;
    font-size: 14px;
    overflow-y: auto;
    height: calc(100% - 120px);
  }

  .ui-button {
    display: inline-block;
    margin: 6px;
    padding: 8px 16px;
    font-size: 14px;
    border: 2px solid #fff;
    background: rgba(0,0,0,0.4);
    color: #fff;
    cursor: pointer;
  }

  .ui-button:hover {
    background: rgba(255,255,255,0.2);
  }

  /* Overworld map */
  #map-container {
    position: relative;
    width: 100%;
    height: calc(100% - 80px);
    overflow: hidden;
  }

  #world-map {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Biome screen */
  #biome-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    z-index: 0;
  }

  #day-night-indicator {
    position: absolute;
    top: 4px;
    right: 8px;
    padding: 4px 8px;
    background: rgba(0,0,0,0.5);
    font-size: 12px;
    border-radius: 4px;
  }

  #biome-log {
    position: absolute;
    bottom: 80px;
    left: 4px;
    right: 4px;
    max-height: 100px;
    overflow-y: auto;
    background: rgba(0,0,0,0.4);
    padding: 4px;
    font-size: 12px;
  }

  #encounter-button {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
  }

  #biome-to-overworld {
    position: absolute;
    top: 40px;
    left: 8px;
  }

  /* Encounter screen */
  #encounter-screen {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 5;
  }

  #encounter-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    opacity: 0.4;
  }

  #encounter-content {
    position: relative;
    z-index: 10;
    text-align: center;
    padding: 20px;
    background: rgba(0,0,0,0.7);
    border-radius: 8px;
  }

  .creature-img {
    width: 120px;
    height: 120px;
    image-rendering: pixelated;
  }

  .encounter-name {
    font-size: 18px;
    margin-top: 6px;
  }

  .catch-rate {
    font-size: 14px;
    margin: 6px 0;
  }

  .message {
    margin-top: 8px;
    font-size: 14px;
    min-height: 24px;
  }

  /* Codex */
  #codex-list {
    display: flex;
    flex-wrap: wrap;
    padding: 8px;
    height: calc(100% - 80px);
    overflow-y: auto;
  }

  .codex-entry {
    width: 60px;
    margin: 4px;
    text-align: center;
    font-size: 10px;
  }

  .codex-entry img {
    width: 48px;
    height: 48px;
    image-rendering: pixelated;
    border: 1px solid #555;
    background: #222;
  }

  .codex-entry .name {
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  </style>
</head>
<body>
  <div id="app">
    <!-- Ranch Screen -->
    <div id="ranch-screen" class="screen">
      <div class="header">Ranch</div>
      <div id="ranch-summary" class="summary"></div>
      <button id="go-to-overworld" class="ui-button">Go to Overworld</button>
    </div>

    <!-- Overworld Screen -->
    <div id="overworld-screen" class="screen">
      <div class="header">World Map</div>
      <div id="map-container">
        <img id="world-map" src="assets/backgrounds/overworld.png" alt="World Map"/>
        <!-- clickable regions overlayed via JS -->
      </div>
      <button id="open-codex" class="ui-button">Codex</button>
      <button id="return-to-ranch" class="ui-button">Back to Ranch</button>
    </div>

    <!-- Biome Screen (generic for each biome) -->
    <div id="biome-screen" class="screen">
      <div class="header" id="biome-title"></div>
      <div id="biome-background" class="biome-bg"></div>
      <div id="day-night-indicator" class="indicator"></div>
      <div id="biome-log" class="log"></div>
      <button id="encounter-button" class="ui-button">Encounter (<span id="encounter-count">0</span>)</button>
      <button id="biome-to-overworld" class="ui-button">Back</button>
    </div>

    <!-- Encounter Screen -->
    <div id="encounter-screen" class="screen">
      <div id="encounter-bg" class="encounter-bg"></div>
      <div id="encounter-content" class="encounter-content">
        <img id="encounter-image" src="" alt="Creature" class="creature-img"/>
        <div id="encounter-name" class="encounter-name"></div>
        <div id="catch-rate" class="catch-rate"></div>
        <button id="catch-button" class="ui-button">Catch</button>
        <div id="encounter-message" class="message"></div>
      </div>
    </div>

    <!-- Codex Screen -->
    <div id="codex-screen" class="screen">
      <div class="header">Codex</div>
      <div id="codex-list" class="codex-list"></div>
      <button id="close-codex" class="ui-button">Back</button>
    </div>
  </div>

  <!-- Inline JavaScript. This code corresponds to the original main.js file. -->
  <script>
  (function() {
    // Catch rate distribution – applied to 10 creatures in each biome in order
    const CATCH_RATES = [95, 90, 80, 75, 70, 50, 45, 40, 35, 25];

    // Define creatures and assign catch rates by biome/time order
    const creatureList = [
      'verdant_leaflon', 'verdant_barkhorn', 'verdant_dewhopper', 'verdant_suncollar', 'verdant_sproutling',
      'verdant_gloomdrake', 'verdant_shadowpouncer', 'verdant_moonfen', 'verdant_shadehopper', 'verdant_starbit',
      'desert_sunscale', 'desert_sandrunner', 'desert_cactusaur', 'desert_mirageback', 'desert_dustwing',
      'desert_dunehowl', 'desert_nightcrawler', 'desert_mirageglider', 'desert_sandshiver', 'desert_aridclaw',
      'ocean_seapup', 'ocean_coralhorn', 'ocean_tideback', 'ocean_splashfin', 'ocean_wavefoot',
      'ocean_deepglow', 'ocean_moonray', 'ocean_abyssclaw', 'ocean_mistwing', 'ocean_whirlpooler',
      'mountain_iceback', 'mountain_snowtail', 'mountain_frosthorn', 'mountain_glacierpaw', 'mountain_chilldrake',
      'mountain_iciclex', 'mountain_nightfrost', 'mountain_winterstalk', 'mountain_snowmantle', 'mountain_iceblink',
      'swamp_mudfin', 'swamp_bogmaw', 'swamp_marshclaw', 'swamp_fenrunner', 'swamp_vinecrest',
      'swamp_mireglow', 'swamp_sludgeback', 'swamp_fogwhisp', 'swamp_croakshade', 'swamp_nightvine'
    ];

    // Build creature info mapping
    const CREATURES = {};
    for (let i = 0; i < creatureList.length; i++) {
      const id = creatureList[i];
      const catchRate = CATCH_RATES[i % CATCH_RATES.length];
      const displayName = id.split('_').slice(1).join(' ');
      CREATURES[id] = {
        id,
        name: displayName.charAt(0).toUpperCase() + displayName.slice(1),
        catchRate,
        baseImg: `assets/creatures/base/${id}_base.png`,
        uniqueImg: `assets/creatures/unique/${id}_unique.png`
      };
    }

    // Biome definitions
    const BIOMES = {
      verdant: {
        displayName: 'Verdant Glade',
        day: creatureList.slice(0, 5),
        night: creatureList.slice(5, 10),
        background: 'forest_day.png'
      },
      desert: {
        displayName: 'Scorching Dunes',
        day: creatureList.slice(10, 15),
        night: creatureList.slice(15, 20),
        background: 'desert_day.png'
      },
      ocean: {
        displayName: 'Tidal Reef',
        day: creatureList.slice(20, 25),
        night: creatureList.slice(25, 30),
        background: 'ocean_day.png'
      },
      mountain: {
        displayName: 'Frost Peaks',
        day: creatureList.slice(30, 35),
        night: creatureList.slice(35, 40),
        background: 'mountain_day.png'
      },
      swamp: {
        displayName: 'Murk Swamp',
        day: creatureList.slice(40, 45),
        night: creatureList.slice(45, 50),
        background: 'swamp_day.png'
      }
    };

    // State variables
    let codex = {};
    let gold = 0;
    let currentBiome = null;
    let currentArea = 'ranch';
    let rapidRemaining = 0;
    let pendingEncounterQueue = [];
    let lastUpdate = Date.now();

    // DOM element references
    const ranchScreen = document.getElementById('ranch-screen');
    const overworldScreen = document.getElementById('overworld-screen');
    const biomeScreen = document.getElementById('biome-screen');
    const encounterScreen = document.getElementById('encounter-screen');
    const codexScreen = document.getElementById('codex-screen');
    const ranchSummary = document.getElementById('ranch-summary');
    const worldMap = document.getElementById('world-map');
    const mapContainer = document.getElementById('map-container');
    const codexList = document.getElementById('codex-list');
    const encounterImage = document.getElementById('encounter-image');
    const encounterName = document.getElementById('encounter-name');
    const catchRateEl = document.getElementById('catch-rate');
    const encounterMessage = document.getElementById('encounter-message');
    const biomeTitle = document.getElementById('biome-title');
    const biomeBg = document.getElementById('biome-background');
    const encounterBg = document.getElementById('encounter-bg');
    const dayNightIndicator = document.getElementById('day-night-indicator');
    const biomeLog = document.getElementById('biome-log');
    const encounterCountSpan = document.getElementById('encounter-count');

    // Load saved data from localStorage
    function loadData() {
      try {
        const data = JSON.parse(localStorage.getItem('shinyData') || '{}');
        codex = data.codex || {};
        gold = data.gold || 0;
        currentBiome = data.currentBiome || null;
        lastUpdate = data.lastUpdate || Date.now();
        rapidRemaining = data.rapidRemaining || 0;
      } catch (e) {
        codex = {};
      }
      // Initialise codex entries for each creature
      for (const cid of creatureList) {
        if (!codex[cid]) {
          codex[cid] = { standard: false, radiant: false, unique: false, sighted: 0 };
        }
      }
    }

    // Save data to localStorage
    function saveData() {
      localStorage.setItem('shinyData', JSON.stringify({
        codex,
        gold,
        currentBiome,
        lastUpdate: Date.now(),
        rapidRemaining
      }));
    }

    // Determine day or night based on local time (6am–6pm is day)
    function getDayPhase() {
      const now = new Date();
      const hour = now.getHours();
      return (hour >= 6 && hour < 18) ? 'day' : 'night';
    }

    // Calculate rapid encounters based on time offline
    function calculateOfflineEncounters() {
      const now = Date.now();
      if (currentBiome) {
        const diff = now - lastUpdate;
        const minutes = Math.floor(diff / (1000 * 60));
        const count = Math.min(60, Math.floor(minutes / 10));
        rapidRemaining += count;
      }
      lastUpdate = now;
    }

    // UI screen management
    function showScreen(screen) {
      for (const el of [ranchScreen, overworldScreen, biomeScreen, encounterScreen, codexScreen]) {
        el.style.display = (el === screen) ? 'block' : 'none';
      }
      currentArea = screen.id.replace('-screen', '');
      if (screen === biomeScreen) {
        updateDayNightIndicator();
      }
      saveData();
    }

    // Update the day/night indicator and apply overlay for night
    function updateDayNightIndicator() {
      const phase = getDayPhase();
      dayNightIndicator.textContent = phase.toUpperCase();
      if (phase === 'night') {
        biomeBg.style.filter = 'brightness(0.6)';
      } else {
        biomeBg.style.filter = 'brightness(1)';
      }
    }

    // Enter a biome
    function enterBiome(biomeKey) {
      currentBiome = biomeKey;
      rapidRemaining = 0; // reset rapid on entering new biome
      lastUpdate = Date.now();
      biomeTitle.textContent = BIOMES[biomeKey].displayName;
      biomeBg.style.backgroundImage = `url(assets/backgrounds/${BIOMES[biomeKey].background})`;
      biomeLog.innerHTML = '';
      updateEncounterCount();
      updateDayNightIndicator();
      showScreen(biomeScreen);
    }

    // Update encounter count display
    function updateEncounterCount() {
      encounterCountSpan.textContent = rapidRemaining;
    }

    // Generate a single encounter result
    function generateEncounterResult() {
      const phase = getDayPhase();
      const biome = BIOMES[currentBiome];
      const pool = (phase === 'day') ? biome.day : biome.night;
      const creatureId = pool[Math.floor(Math.random() * pool.length)];
      const roll = Math.floor(Math.random() * 5000) + 1;
      let variant = 'standard';
      if (roll === 5000) {
        variant = 'unique';
      } else if (roll >= 4500) {
        variant = 'radiant';
      }
      return { creatureId, variant };
    }

    // Process queued encounters
    function processQueue() {
      while (rapidRemaining > 0) {
        const { creatureId, variant } = generateEncounterResult();
        const info = CREATURES[creatureId];
        const entry = codex[creatureId];
        // Already captured variant?
        if (entry[variant]) {
          entry.sighted += 1;
          gold += 1;
          logBiome(`Spotted ${info.name} (${variant}) — +1 gold`);
          rapidRemaining--;
        } else {
          rapidRemaining--;
          showEncounter({ creatureId, variant });
          return;
        }
      }
      updateEncounterCount();
      showScreen(biomeScreen);
    }

    // Add message to biome log (keep last 5 messages)
    function logBiome(msg) {
      const entry = document.createElement('div');
      entry.textContent = msg;
      biomeLog.appendChild(entry);
      while (biomeLog.children.length > 5) {
        biomeLog.removeChild(biomeLog.firstChild);
      }
    }

    // Show an encounter screen for a new variant
    function showEncounter({ creatureId, variant }) {
      const info = CREATURES[creatureId];
      encounterBg.style.backgroundImage = biomeBg.style.backgroundImage;
      let imgSrc;
      if (variant === 'unique') {
        imgSrc = info.uniqueImg;
      } else {
        imgSrc = info.baseImg;
      }
      encounterImage.src = imgSrc;
      if (variant === 'radiant') {
        encounterImage.style.filter = 'hue-rotate(160deg) saturate(1.5) brightness(1.2)';
      } else {
        encounterImage.style.filter = '';
      }
      encounterName.textContent = `${info.name} (${variant.toUpperCase()})`;
      catchRateEl.textContent = `Catch chance: ${info.catchRate}%`;
      encounterMessage.textContent = '';
      const catchBtn = document.getElementById('catch-button');
      catchBtn.onclick = () => {
        attemptCatch(creatureId, variant);
      };
      showScreen(encounterScreen);
    }

    // Attempt to catch a creature
    function attemptCatch(creatureId, variant) {
      const info = CREATURES[creatureId];
      const entry = codex[creatureId];
      const success = Math.random() * 100 < info.catchRate;
      if (success) {
        entry[variant] = true;
        entry.sighted += 1;
        gold += 2;
        encounterMessage.textContent = `Success! You caught ${info.name}.`;
      } else {
        entry.sighted += 1;
        encounterMessage.textContent = `${info.name} broke free!`;
      }
      document.getElementById('catch-button').disabled = true;
      setTimeout(() => {
        document.getElementById('catch-button').disabled = false;
        resumeHunting();
      }, 1000);
    }

    function resumeHunting() {
      if (rapidRemaining > 0) {
        showScreen(biomeScreen);
        updateEncounterCount();
        processQueue();
      } else {
        showScreen(biomeScreen);
        updateEncounterCount();
      }
    }

    // Build ranch summary showing counts of caught creatures
    function buildRanchSummary() {
      const counts = {};
      for (const biomeKey in BIOMES) {
        counts[biomeKey] = { standard: 0, radiant: 0, unique: 0 };
      }
      for (const cid in codex) {
        const [biomeKey] = cid.split('_');
        const entry = codex[cid];
        if (entry.standard) counts[biomeKey].standard++;
        if (entry.radiant) counts[biomeKey].radiant++;
        if (entry.unique) counts[biomeKey].unique++;
      }
      let html = `<div>Gold: ${gold}</div>`;
      for (const biomeKey in BIOMES) {
        const biome = BIOMES[biomeKey];
        const c = counts[biomeKey];
        html += `<div><strong>${biome.displayName}:</strong> Caught ${c.standard}/10 (Std), ${c.radiant} (Rad), ${c.unique} (Uni)</div>`;
      }
      ranchSummary.innerHTML = html;
    }

    // Build codex list
    function buildCodex() {
      codexList.innerHTML = '';
      for (const cid of creatureList) {
        const info = CREATURES[cid];
        const entry = codex[cid];
        const container = document.createElement('div');
        container.classList.add('codex-entry');
        const imgEl = document.createElement('img');
        if (entry.standard || entry.radiant || entry.unique) {
          imgEl.src = info.baseImg;
          if (entry.unique) {
            imgEl.src = info.uniqueImg;
          } else if (entry.radiant) {
            imgEl.style.filter = 'hue-rotate(160deg) saturate(1.5) brightness(1.2)';
          }
        } else {
          imgEl.src = info.baseImg;
          imgEl.style.filter = 'grayscale(100%) brightness(0.3)';
        }
        const nameEl = document.createElement('div');
        nameEl.classList.add('name');
        nameEl.textContent = info.name;
        container.appendChild(imgEl);
        container.appendChild(nameEl);
        codexList.appendChild(container);
      }
    }

    // Create clickable biome regions on the map
    function setupMapRegions() {
      const regions = {
        verdant: { left: 6, top: 10, width: 25, height: 30 },
        desert: { left: 38, top: 12, width: 25, height: 30 },
        mountain: { left: 70, top: 12, width: 25, height: 30 },
        swamp: { left: 10, top: 55, width: 25, height: 30 },
        ocean: { left: 58, top: 55, width: 30, height: 30 }
      };
      for (const biomeKey in regions) {
        const r = regions[biomeKey];
        const div = document.createElement('div');
        div.classList.add('map-region');
        div.style.position = 'absolute';
        div.style.left = r.left + '%';
        div.style.top = r.top + '%';
        div.style.width = r.width + '%';
        div.style.height = r.height + '%';
        div.style.cursor = 'pointer';
        div.style.background = 'rgba(0,0,0,0)';
        div.addEventListener('click', () => enterBiome(biomeKey));
        mapContainer.appendChild(div);
      }
    }

    // Attach event handlers
    function setupEventHandlers() {
      document.getElementById('go-to-overworld').onclick = () => {
        buildRanchSummary();
        showScreen(overworldScreen);
      };
      document.getElementById('return-to-ranch').onclick = () => {
        showScreen(ranchScreen);
      };
      document.getElementById('biome-to-overworld').onclick = () => {
        showScreen(overworldScreen);
      };
      document.getElementById('open-codex').onclick = () => {
        buildCodex();
        showScreen(codexScreen);
      };
      document.getElementById('close-codex').onclick = () => {
        showScreen(overworldScreen);
      };
      document.getElementById('encounter-button').onclick = () => {
        if (rapidRemaining > 0) {
          processQueue();
        } else {
          rapidRemaining = 1;
          processQueue();
        }
        updateEncounterCount();
      };
      window.addEventListener('beforeunload', () => {
        saveData();
      });
    }

    // Initialise game on load
    function init() {
      loadData();
      calculateOfflineEncounters();
      buildRanchSummary();
      setupMapRegions();
      setupEventHandlers();
      showScreen(ranchScreen);
    }

    init();
  })();
  </script>
</body>
</html>